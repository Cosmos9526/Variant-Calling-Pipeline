
# Variant Calling Pipeline with Docker
## Overview
 pipeline performs variant calling using Strelka, FreeBayes, VarScan, and GATK HaplotypeCaller. Input files include a BAM file and a VCF file. The pipeline generates recalibrated BAM files and a consensus VCF file containing variant calls. The final VCF file serves as input for VEP annotation, producing a comprehensive variant report.



This pipeline performs variant calling using Strelka, FreeBayes, and VarScan, with the results combined into a consensus set. It takes BAM and VCF files as input, and generates variant calls that can later be annotated using VEP. The entire process happens within a Docker environment.

## Important Notes

1. You can either start this pipeline from the beginning using the repository where Fastq files are automatically converted to VCF files, or you can proceed by using an existing VCF file.
   
2. If you're using an existing VCF file, you must duplicate the file and rename one as `normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz`.

3. The input file for this pipeline should be a BAM file named:  
   `normal_BWA_Alignment_Quality_Score_Recalibrated.bam`.

## Docker Image

To run the pipeline, ensure you have pulled the following Docker image:

```bash
docker pull cosmos9526/varient_calling:latest
```

## Input Requirements

The input folder should contain the following files:

- **BAM File**: `normal_BWA_Alignment_Quality_Score_Recalibrated.bam`
- **VCF File**: `normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz`
- **Index File**: Corresponding index files for BAM and VCF.

Make sure your input files are named as specified.

## Output

The pipeline will generate the following:

- **Recalibrated BAM files**: Aligned and quality recalibrated.
- **VCF File**: Consensus variant calls generated by Strelka, FreeBayes, and VarScan.
- **Index Files**: BAM and VCF index files.

The final output file will be used as an input for VEP ensemble annotation, resulting in a `.txt` output file.

## Running the Script

The repository includes a script named `run2.py`, which should be placed in the main directory along with your input files and the Docker setup. The directory structure should look like this:

```
/your_project_directory/
├── input/
│   ├── normal_BWA_Alignment_Quality_Score_Recalibrated.bam
│   ├── normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz
├── output/
├── run2.py
```

### Docker Command

You can execute the pipeline using the following command:

```bash
python3 run2.py
```

The `run2.py` script will handle running the Docker container, processing the input files, and generating the output.

## Final Note

In the final step of the pipeline, a consensus is taken from the results of all four variant callers (Strelka, FreeBayes, VarScan, and GATK), ensuring comprehensive variant identification.

