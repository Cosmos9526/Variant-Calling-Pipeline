
# Variant Calling Pipeline with Docker
## Overview
 pipeline performs variant calling using Strelka, FreeBayes, VarScan, and GATK HaplotypeCaller. Input files include a BAM file and a VCF file. The pipeline generates recalibrated BAM files and a consensus VCF file containing variant calls. The final VCF file serves as input for VEP annotation, producing a comprehensive variant report.



This pipeline performs variant calling using Strelka, FreeBayes, and VarScan, with the results combined into a consensus set. It takes BAM and VCF files as input, and generates variant calls that can later be annotated using VEP. The entire process happens within a Docker environment.

## Important Notes

If you want to start with a BAM file, since the final step of the pipeline automatically takes a consensus of the output from the four variant calling modules, use the following trick:

After the first module of variant calling is completed, take a copy of the VCF file and rename it to normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz, and be sure to generate its index.

However, for optimal results, it’s recommended to start with Fastq files. You can follow the instructions in this repository for a full Fastq to VCF pipeline:

https://github.com/Cosmos9526/Automated-Fastq-to-VCF-Pipeline

## Docker Image

To run the pipeline, ensure you have pulled the following Docker image:

```bash
docker pull cosmos9526/varient_calling:latest
```

## Input Requirements

The input folder should contain the following files:

- **BAM File**: `normal_BWA_Alignment_Quality_Score_Recalibrated.bam`
- **VCF File**: `normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz`
- **Index File**: Corresponding index files for BAM and VCF.

Make sure your input files are named as specified.

## Output

The pipeline will generate the following:

- **Recalibrated BAM files**: Aligned and quality recalibrated.
- **VCF File**: Consensus variant calls generated by Strelka, FreeBayes, and VarScan.
- **Index Files**: BAM and VCF index files.

The final output file will be used as an input for VEP ensemble annotation, resulting in a `.txt` output file.

## Running the Script

The repository includes a script named `run2.py`, which should be placed in the main directory along with your input files and the Docker setup. The directory structure should look like this:

```
/your_project_directory/
├── input/
│   ├── normal_BWA_Alignment_Quality_Score_Recalibrated.bam
│   ├── normal_haplotypeCaller_recalibrated_SNPs_INDELs.vcf.gz
├── output/
├── run2.py
```

### Docker Command

You can execute the pipeline using the following command:

```bash
python3 run2.py
```

The `run2.py` script will handle running the Docker container, processing the input files, and generating the output.

## Final Note

In the final step of the pipeline, a consensus is taken from the results of all four variant callers (Strelka, FreeBayes, VarScan, and GATK), ensuring comprehensive variant identification.

## contact info
Milad Bagheri milad9dxb@gmail.com


